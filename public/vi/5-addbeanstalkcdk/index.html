<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.96.0" />
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Thêm Elastic Beanstalk CDK  :: Triển khai ứng dụng web với Elasitc Beanstalk và CDK Pipeline</title>

    
    <link href="/css/nucleus.css?1708519296" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1708519296" rel="stylesheet">
    <link href="/css/hybrid.css?1708519296" rel="stylesheet">
    <link href="/css/featherlight.min.css?1708519296" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1708519296" rel="stylesheet">
    <link href="/css/auto-complete.css?1708519296" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1708519296" rel="stylesheet">
    <link href="/css/theme.css?1708519296" rel="stylesheet">
    <link href="/css/hugo-theme.css?1708519296" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1708519296" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1708519296"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/5-addbeanstalkcdk/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1708519296"></script>
<script type="text/javascript" src="/js/auto-complete.js?1708519296"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1708519296"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduction/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-preparation/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-preparation/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-preparation/2.1-createrepo/" title="Tạo GitHub Repository" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-preparation/2.1-createrepo/">
           <b> 2.1 </b> Tạo GitHub Repository
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-preparation/2.2-setupenv/" title="Chuẩn bị môi trường" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-preparation/2.2-setupenv/">
           <b> 2.2 </b> Chuẩn bị môi trường
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-buildapp/" title="Xây dựng ứng dụng web" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-buildapp/">
           <b> 3. </b> Xây dựng ứng dụng web
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-createinfrausingcdk/" title="Tạo hạ tầng bằng CDK" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-createinfrausingcdk/">
           <b> 4. </b> Tạo hạ tầng bằng CDK
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-addbeanstalkcdk/" title="Thêm Elastic Beanstalk CDK " class="dd-item 
        parent
        active
        
        ">
      <a href="/vi/5-addbeanstalkcdk/">
           <b> 5. </b> Thêm Elastic Beanstalk CDK 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-createcdkpipelinestack/" title="Tạo CICD Pipeline Stack" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-createcdkpipelinestack/">
           <b> 6. </b> Tạo CICD Pipeline Stack
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-deployapp/" title="Triển khai ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="/vi/7-deployapp/">
           <b> 7. </b> Triển khai ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/8-checkresult/" title="Kiểm tra kết quả" class="dd-item 
        
        
        
        ">
      <a href="/vi/8-checkresult/">
           <b> 8. </b> Kiểm tra kết quả
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/9-cleanup/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/9-cleanup/">
           <b> 9. </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/5-addbeanstalkcdk/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/5-addbeanstalkcdk/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> 
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/vanhoangkha/"  style="color:orange">Hoàng Kha  </a> <br>
                <a href="https://www.linkedin.com/in/tonychanhnguyen/"  style="color:orange">Minh Chánh </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/vi/'>Triển khai ứng dụng web với Elasitc Beanstalk và CDK Pipeline</a> > Thêm Elastic Beanstalk CDK 
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#thêm-elastic-beanstalk-cdk-dependencies">Thêm Elastic Beanstalk CDK Dependencies</a></li>
        <li><a href="#tạo-phiên-bản-ứng-dụng-elastic-beanstalk">Tạo phiên bản ứng dụng Elastic Beanstalk</a></li>
        <li><a href="#tạo-instance-profile">Tạo Instance Profile</a></li>
        <li><a href="#tạo-môi-trường-elastic-beanstalk">Tạo môi trường Elastic Beanstalk</a></li>
        <li><a href="#cuối-cùng-code-của-tệp-libeb-appln-stackts">Cuối cùng, code của tệp lib/eb-appln-stack.ts:</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Thêm Elastic Beanstalk CDK 
            </h1>
          

        



	<h3 id="thêm-elastic-beanstalk-cdk-dependencies">Thêm Elastic Beanstalk CDK Dependencies</h3>
<p>kế tiếp, chúng ta sẽ tạo ứng dụng Elastic Beanstalk, phiên bản ứng dụng, và môi trường để chúng ta có thể triển khai ứng dụng web đã được tải lên S3 bằng S3 Assets.</p>
<ol>
<li>Thêm dependency vào Elastic Beanstalk cho CDK tại phần trên của tệp <strong>lib/eb-appln-stack.ts</strong>.</li>
</ol>

<div class="notices " ><pre><code>import * as elasticbeanstalk from 'aws-cdk-lib/aws-elasticbeanstalk';
</code></pre>
</div>

<ol start="2">
<li>Đặt code phía dưới code của S3 Assets trong tệp <strong>lib/eb-appln-stack.ts file</strong>. Đoạn code này sẽ tạo một ứng dụng tên MyWebApp tại Elastic Beanstalk.</li>
</ol>

<div class="notices " ><pre><code>const appName = 'MyWebApp';
const app = new elasticbeanstalk.CfnApplication(this, 'Application', {
    applicationName: appName,
});
</code></pre>
</div>

<h3 id="tạo-phiên-bản-ứng-dụng-elastic-beanstalk">Tạo phiên bản ứng dụng Elastic Beanstalk</h3>
<p>Bây giờ chúng ta cần tạo phiên bản ứng dụng Elastic Beanstalk từ tài nguyên trên S3 đã được tạo trước đó.</p>
<ol>
<li>Phần code này sẽ tạo phiên bản ứng dụng bằng cách sử dụng S3 bucket name và S3 object key mà S3 Assets và CDK sẽ cũng cấp cho phương thức này.</li>
</ol>

<div class="notices " ><pre><code>// Create an app version from the S3 asset defined earlier
const appVersionProps = new elasticbeanstalk.CfnApplicationVersion(this, 'AppVersion', {
    applicationName: appName,
    sourceBundle: {
        s3Bucket: webAppZipArchive.s3BucketName,
        s3Key: webAppZipArchive.s3ObjectKey,
    },
});
</code></pre>
</div>

<ol start="2">
<li>Thêm một dependency để đảm bảo rằng ứng dụng Elastic Beanstalk application tồn tại trước khi tạo phiên bản ứng dụng.</li>
</ol>

<div class="notices " ><pre><code>// Make sure that Elastic Beanstalk app exists before creating an app version
appVersionProps.addDependency(app);
</code></pre>
</div>

<h3 id="tạo-instance-profile">Tạo Instance Profile</h3>
<p>Để tạo môi trường Elastic Beanstalk, chúng ta sẽ cần cung cấp một instance profile để thông qua vai trò thông tin đến máy chủ Amazon EC2 khi nó khởi chạy.</p>
<ol>
<li>Thêm IAM dependency trong CDK stack.</li>
</ol>

<div class="notices " ><pre><code>import * as iam from 'aws-cdk-lib/aws-iam';
</code></pre>
</div>

<ol start="2">
<li>Tạo phiên bản ứng dụng:
<ul>
<li>Điều đầu tiên đoạn code làm là tạo ra một IAM role mới (<strong>myRole</strong>).</li>
<li>Để cho phép máy chủ EC2 trong môi trường của chúng ta đảm nhận role, instance profile chỉ định Amazon EC2 với tư cách là một thực thể đáng tin cậy trong chính sách mối quan hệ tin cậy.</li>
<li>Với vai trò đó, sau đó chúng ta thêm chính sách được quản lý <strong>AWSElasticBeanstalkWebTier</strong>. Sau đó chúng ta tạo instance profile với vai trò đó và tên hồ sơ.</li>
</ul>
</li>
</ol>

<div class="notices " ><pre><code>// Create role and instance profile
const myRole = new iam.Role(this, `${appName}-aws-elasticbeanstalk-ec2-role`, {
    assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
});

const managedPolicy = iam.ManagedPolicy.fromAwsManagedPolicyName('AWSElasticBeanstalkWebTier')
myRole.addManagedPolicy(managedPolicy);

const myProfileName = `${appName}-InstanceProfile`

const instanceProfile = new iam.CfnInstanceProfile(this, myProfileName, {
    instanceProfileName: myProfileName,
    roles: [
        myRole.roleName
    ]
});
</code></pre>
</div>

<h3 id="tạo-môi-trường-elastic-beanstalk">Tạo môi trường Elastic Beanstalk</h3>
<p>Phần cuối cùng chúng ta cần tạo là môi trường Elastic Beanstalk. Môi trường là một tập hợp các tài nguyên AWS chạy trên một phiên bản ứng dụng. Đối với môi trường, chúng ta sẽ cần cung cấp một số thông tin về cơ sở hạ tầng.</p>
<ol>
<li>Để xác định các tùy chọn cấu hình, hãy thêm các dòng code sau:</li>
</ol>

<div class="notices " ><pre><code>// Example of some options which can be configured
const optionSettingProperties: elasticbeanstalk.CfnEnvironment.OptionSettingProperty[] = [
    {
        namespace: 'aws:autoscaling:launchconfiguration',
        optionName: 'IamInstanceProfile',
        value: myProfileName,
    },
    {
        namespace: 'aws:autoscaling:asg',
        optionName: 'MinSize',
        value: props?.maxSize ?? '1',
    },
    {
        namespace: 'aws:autoscaling:asg',
        optionName: 'MaxSize',
        value: props?.maxSize ?? '1',
    },
    {
        namespace: 'aws:ec2:instances',
        optionName: 'InstanceTypes',
        value: props?.instanceTypes ?? 't2.micro',
    },
];
</code></pre>
</div>

<ol start="2">
<li>Thêm các dòng code dưới đây vào tệp <strong>lib/eb-appln-stack.ts</strong>:</li>
</ol>

<div class="notices " ><pre><code>// Create an Elastic Beanstalk environment to run the application
const elbEnv = new elasticbeanstalk.CfnEnvironment(this, 'Environment', {
    environmentName: props?.envName ?? &quot;MyWebAppEnvironment&quot;,
    applicationName: app.applicationName || appName,
    solutionStackName: 'SOLUTION-STACK-NAME',
    optionSettings: optionSettingProperties,
    versionLabel: appVersionProps.ref,
});
</code></pre>
</div>

<ol start="3">
<li>Thay thế <strong>SOLUTION-STACK-NAME</strong> với <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/platforms/platforms-supported.html?sc_channel=el&amp;sc_campaign=devopswave&amp;sc_content=cicdcdkebaws&amp;sc_geo=mult&amp;sc_country=mult&amp;sc_outcome=acq#platforms-supported.nodejs">Phiên bản mới nhất của Solution Stack Name được hổ trợ</a>. Tại thời điểm này, phiên bản mới nhất là <code>64bit Amazon Linux 2023 v6.0.2 running Node.js 18</code>.
<img src="../../images/5.addbeanstalk/5.1version.png?pc=90pt" alt="Create CDK Infrastructure"></li>
</ol>
<h3 id="cuối-cùng-code-của-tệp-libeb-appln-stackts">Cuối cùng, code của tệp lib/eb-appln-stack.ts:</h3>

<div class="notices " ><pre><code>import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
// Add import statements here
import * as s3assets from 'aws-cdk-lib/aws-s3-assets';
import * as elasticbeanstalk from 'aws-cdk-lib/aws-elasticbeanstalk';
import * as iam from 'aws-cdk-lib/aws-iam';
export interface EBEnvProps extends cdk.StackProps {
    // Autoscaling group configuration
minSize?: string;
maxSize?: string;
instanceTypes?: string;
envName?: string;
}

export class EBApplnStack extends cdk.Stack {
constructor(scope: Construct, id: string, props?: EBEnvProps) {
    super(scope, id, props);

    // The code that defines your stack goes here
    // Construct an S3 asset Zip from directory up.
    const webAppZipArchive = new s3assets.Asset(this, 'WebAppZip', {
    path: `${__dirname}/../src`,
    });
    
    const appName = 'MyWebApp';
    const app = new elasticbeanstalk.CfnApplication(this, 'Application', {
        applicationName: appName,
    });
    
    // Create an app version from the S3 asset defined earlier
    const appVersionProps = new elasticbeanstalk.CfnApplicationVersion(this, 'AppVersion', {
    applicationName: appName,
    sourceBundle: {
        s3Bucket: webAppZipArchive.s3BucketName,
        s3Key: webAppZipArchive.s3ObjectKey,
    },
    });
    
    // Make sure that Elastic Beanstalk app exists before creating an app version
    appVersionProps.addDependency(app);
    
    // Create role and instance profile
    const myRole = new iam.Role(this, `${appName}-aws-elasticbeanstalk-ec2-role`, {
        assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
    });
    
    const managedPolicy = iam.ManagedPolicy.fromAwsManagedPolicyName('AWSElasticBeanstalkWebTier')
    myRole.addManagedPolicy(managedPolicy);
    
    const myProfileName = `${appName}-InstanceProfile`
    
    const instanceProfile = new iam.CfnInstanceProfile(this, myProfileName, {
        instanceProfileName: myProfileName,
        roles: [
            myRole.roleName
        ]
    });

    // Example of some options which can be configured
    const optionSettingProperties: elasticbeanstalk.CfnEnvironment.OptionSettingProperty[] = [
        {
            namespace: 'aws:autoscaling:launchconfiguration',
            optionName: 'IamInstanceProfile',
            value: myProfileName,
        },
        {
            namespace: 'aws:autoscaling:asg',
            optionName: 'MinSize',
            value: props?.maxSize ?? '1',
        },
        {
            namespace: 'aws:autoscaling:asg',
            optionName: 'MaxSize',
            value: props?.maxSize ?? '1',
        },
        {
            namespace: 'aws:ec2:instances',
            optionName: 'InstanceTypes',
            value: props?.instanceTypes ?? 't2.micro',
        },
    ];

    // Create an Elastic Beanstalk environment to run the application
    const elbEnv = new elasticbeanstalk.CfnEnvironment(this, 'Environment', {
        environmentName: props?.envName ?? &quot;MyWebAppEnvironment&quot;,
        applicationName: app.applicationName || appName,
        solutionStackName: '64bit Amazon Linux 2023 v6.0.2 running Node.js 18',
        optionSettings: optionSettingProperties,
        versionLabel: appVersionProps.ref,
    });

}
}
</code></pre>
</div>






<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/4-createinfrausingcdk/" title="Tạo hạ tầng bằng CDK"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/6-createcdkpipelinestack/" title="Tạo CICD Pipeline Stack" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1708519296"></script>
    <script src="/js/perfect-scrollbar.min.js?1708519296"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1708519296"></script>
    <script src="/js/jquery.sticky.js?1708519296"></script>
    <script src="/js/featherlight.min.js?1708519296"></script>
    <script src="/js/highlight.pack.js?1708519296"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1708519296"></script>
    <script src="/js/learn.js?1708519296"></script>
    <script src="/js/hugo-learn.js?1708519296"></script>

    <link href="/mermaid/mermaid.css?1708519296" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1708519296"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
